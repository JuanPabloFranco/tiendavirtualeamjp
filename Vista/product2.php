<?phpinclude './library/consulSQL.php';?><!DOCTYPE html><html lang="es">    <head>        <title>Productos</title>        <?php include './inc/link.php'; ?>    </head>    <body id="container-page-product">        <section id="store">            <br>            <div class="container">                <div class="page-header">                    <h1>Productos en <?php echo EMPRESA . " " . NEMPRESA ?></h1>                </div>                <div class="row">                    <div class="col-xs-12">                        <ul id="store-links" class="nav nav-tabs" role="tablist">                            <li role="presentation"><a href="#all-product" role="tab" data-toggle="tab" aria-controls="all-product" aria-expanded="false">Todos los productos</a></li>                            <li role="presentation" class="dropdown active">                                <a href="#" id="myTabDrop1" class="dropdown-toggle" data-toggle="dropdown" aria-controls="myTabDrop1-contents" aria-expanded="false">Categorías</a>                                <ul class="dropdown-menu" role="menu" aria-labelledby="myTabDrop1" id="myTabDrop1-contents">                                    <!-- ==================== Lista categorias =============== -->                                    <?php                                    $categorias = ejecutarSQL::consultar("select * from categoria");                                    while ($cate = mysqli_fetch_array($categorias)) {                                        echo '                                    <li>                                        <a href="#' . $cate['id'] . '" tabindex="-1" role="tab" id="' . $cate['id'] . '-tab" data-toggle="tab" aria-controls="' . $cate['id'] . '" aria-expanded="false">' . $cate['nombre'] . '                                        </a>                                    </li>';                                    }                                    ?>                                    <!-- ==================== Fin lista categorias =============== -->                                </ul>                            </li>                        </ul>                        <div id="myTabContent" class="tab-content">                            <div role="tabpanel" class="tab-pane fade" id="all-product" aria-labelledby="all-product-tab">                                <br><br>                                <div class="row" id="divCarrito">                                    <?php                                    $consulta = ejecutarSQL::consultar("SELECT producto.id, nombre_prod, marca, precio_venta, estado_prod, imagen, cantidad FROM producto, bodega WHERE bodega.id_producto=producto.id AND (estado_prod_bodega='Disponible' OR estado_prod_bodega='Agotado') AND (estado_prod='Disponible') ORDER BY id_categoria");                                    $totalproductos = mysqli_num_rows($consulta);                                    if ($totalproductos > 0) {                                        $nums = 1;                                        while ($fila = mysqli_fetch_array($consulta)) {                                            ?>                                            <div class="col-xs-12 col-sm-6 col-md-3" >                                                <form method="post" action="DAO/carritoDAO.php" id="res-reg-carrito-<?php echo $nums; ?>">                                                    <input type="hidden" name="id" value="<?php echo $fila['id']; ?>">                                                    <input type="hidden" name="funcion" value="agregarCarrito">                                                    <div class="thumbnail" style="width: 90%">                                                        <!--se inserta la imagen del producto-->                                                        <a onclick="modal_ver_producto(<?php echo $fila['id']; ?>)" ><img style="max-width: 70%" src="Recursos/img-products/<?php echo $fila['imagen'] ?>" data-toggle="popover" data-trigger="hover" data-content="<?php echo $fila['descripcion_prod'] ?>"></a>                                                                                            <div class="caption">                                                            <!--se inserta la información del producto-->                                                                                            <h3  class="text-center"><?php echo $fila['nombre_prod'] ?></h3>                                                            <p  class="text-center"><?php echo $fila['marca'] ?></p>                                                            <p  class="text-center">$<?php echo $fila['precio_venta'] ?></p>                                                            <p class="abs-center">                                                                <a onclick="modal_ver_producto(<?php echo $fila['id']; ?>)" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i>&nbsp; Detalles</a>&nbsp;&nbsp;                                                            </p>                                                            <p class="abs-center">                                                                                           <?php                                                                // El boton de agregar al carrito solo aparece si el usuario es un cliente o no se ha logueado                                                                if (isset($_SESSION['nombreUser']) || empty($_SESSION['nombreAdmin'])) {                                                                    // Se verifica el estado del producto para mostrar el boton                                                                    if ($fila['estado_prod_bodega'] <> 'Agotado') {                                                                        ?>                                                                        <input type="number" value="1" min="1" max="<?php echo $fila['cantidad'] ?>" name="cantidad" style="width: 30%" onchange="cantidadCarrito(this.value);" class="form-control all-elements-tooltip">                                                                        <button type="submit" class="btn btn-sm btn-success button-carrito" value="res-reg-carrito-<?php echo $nums; ?>"><i class="fa fa-shopping-cart"></i>&nbsp; Añadir</button>                                                                        <?php                                                                    }                                                                }                                                                ?>                                                            </p>                                                        </div>                                                    </div>                                                </form>                                            </div>                                            <?php                                            if ($nums % 4 == 0) {                                                echo '<div class="clearfix"></div>';                                            }                                            $nums++;                                        }                                    } else {                                        echo '<h2>No hay productos en esta categoria</h2>';                                    }                                    ?>                                </div>                            </div><!-- Fin del contenedor de todos los productos -->                            <!-- ==================== Contenedores de categorias =============== -->                            <?php                            $consultar_categorias = ejecutarSQL::consultar("SELECT * FROM categoria");                            $nums = 1;                            while ($categ = mysqli_fetch_array($consultar_categorias)) {                                echo '<div role="tabpanel" class="tab-pane fade active in" id="' . $categ['id'] . '" aria-labelledby="' . $categ['id'] . '-tab" id="divCarrito"><br>';                                $consultar_productos = ejecutarSQL::consultar("SELECT producto.id, nombre_prod, marca, precio_venta, estado_prod, imagen, cantidad FROM producto, bodega WHERE bodega.id_producto=producto.id AND id_categoria='" . $categ['codigo_categoria'] . "' AND (estado_prod_bodega='Disponible' OR estado_prod_bodega='Agotado') AND (estado_prod='Disponible') ");                                if ($consultar_productos > 0) {                                    $nums = 1;                                    while ($fila = mysqli_fetch_array($consultar_productos)) {                                        ?>                                        <div class="col-xs-12 col-sm-6 col-md-3" >                                            <form method="post" action="DAO/carritoDAO.php" id="res-reg-carrito-<?php echo $nums; ?>">                                                <input type="hidden" name="id" value="<?php echo $fila['id']; ?>">                                                <input type="hidden" name="funcion" value="agregarCarrito">                                                <div class="thumbnail" style="width: 90%">                                                    <!--se inserta la imagen del producto-->                                                    <a onclick="modal_ver_producto(<?php echo $fila['id']; ?>)" ><img style="max-width: 70%" src="Recursos/img-products/<?php echo $fila['imagen'] ?>" data-toggle="popover" data-trigger="hover" data-content="<?php echo $fila['descripcion_prod'] ?>"></a>                                                                                        <div class="caption">                                                        <!--se inserta la información del producto-->                                                                                        <h3  class="text-center"><?php echo $fila['nombre_prod'] ?></h3>                                                        <p  class="text-center"><?php echo $fila['marca'] ?></p>                                                        <p  class="text-center">$<?php echo $fila['precio_venta'] ?></p>                                                        <p class="abs-center">                                                            <a onclick="modal_ver_producto(<?php echo $fila['id']; ?>)" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i>&nbsp; Detalles</a>&nbsp;&nbsp;                                                        </p>                                                        <p class="abs-center">                                                                                       <?php                                                            // El boton de agregar al carrito solo aparece si el usuario es un cliente o no se ha logueado                                                            if (isset($_SESSION['nombreUser']) || empty($_SESSION['nombreAdmin'])) {                                                                // Se verifica el estado del producto para mostrar el boton                                                                if ($fila['estado_prod_bodega'] <> 'Agotado') {                                                                    ?>                                                                    <input type="number" value="1" min="1" max="<?php echo $fila['cantidad'] ?>" name="cantidad" style="width: 30%" onchange="cantidadCarrito(this.value);" class="form-control all-elements-tooltip">                                                                    <button type="submit" class="btn btn-sm btn-success button-carrito" value="res-reg-carrito-<?php echo $nums; ?>"><i class="fa fa-shopping-cart"></i>&nbsp; Añadir</button>                                                                    <?php                                                                }                                                            }                                                            ?>                                                        </p>                                                    </div>                                                </div>                                            </form>                                        </div>                                        <?php                                        if ($nums % 4 == 0) {                                            echo '<div class="clearfix"></div>';                                        }                                        $nums++;                                    }                                } else {                                    echo '<h2>No hay productos en esta categoría</h2>';                                }                                echo '</div>';                            }                            ?>                            <!-- ==================== Fin contenedores de categorias =============== -->                        </div>                    </div>                </div>            </div>        </section>        <script>            $(document).ready(function () {                $('#store-links a:first').tab('show');            });            // Metodo para lanzar los detalles del producto en una ventana modal en el div verPrducto            function modal_ver_producto(id) {                $('#verProducto').load("Vista/verProducto.php?id=" + id);                $("#verProducto").modal("toggle");            }            $(document).ready(function () {                $("[type='number']").keypress(function (evt) {                    evt.preventDefault();                });                $('.button-carrito').click(function () {                    var myId = $(this).val();                    $('#divCarrito form#' + myId).submit(function (e) {                        e.preventDefault();                        var informacion = $('#divCarrito form#' + myId).serialize();                        var metodo = $('#divCarrito form#' + myId).attr('method');                        var peticion = $('#divCarrito form#' + myId).attr('action');                        $.ajax({                            type: metodo,                            url: peticion,                            data: informacion,                            beforeSend: function () {                                $('.modal-carrito').modal('show'); // Muestra el modal con progreso                                $("#msjCarrito").html('Agregando<br><img src="Recursos/img/enviando.gif" class="center-all-contens">');                            },                            error: function () {                                $('.modal-carrito').modal('show'); // Muestra el modal diciendo que hubo un error                                $("#res-form-update_inf").html("Hubo un error al añadir el producto al carrito");                            },                            success: function (data) {                                $('.modal-carrito').modal('show'); // Muestra el modal diciendo que se agrego al carrito el producto                                $("#res-form-update_inf").html("El producto se añadió al carrito");                            }                        });                        return false;                    });                });            });        </script>    </body></html>